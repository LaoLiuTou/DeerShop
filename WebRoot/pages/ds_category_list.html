<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="ThemeBucket">
  <link rel="shortcut icon" href="#" type="image/png">

  <title>分类管理</title>

  <link href="css/style.css" rel="stylesheet">
  <link href="css/style-responsive.css" rel="stylesheet">

    <!--multi-select-->
    <link rel="stylesheet" type="text/css" href="js/jquery-multi-select/css/multi-select.css" />
    <link href="css/upload/fileinput.css" media="all" rel="stylesheet" type="text/css"/>
    <link href="js/upload/themes/explorer-fa/theme.css" media="all" rel="stylesheet" type="text/css"/>
    <link href="css/font-awesome-4.7.0/css/font-awesome.css" media="all" rel="stylesheet" type="text/css"/>
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="js/html5shiv.js"></script>
  <script src="js/respond.min.js"></script>
  <![endif]-->

</head>

<body class="sticky-header">

<section>
    <!-- left side start-->
    <div class="left-side sticky-left-side">

        <!--logo and iconic logo start-->
        <div class="logo">
            <!-- <a href=""><img src="images/logo.png" alt=""></a>-->
        </div>

        <div class="logo-icon text-center" id="title">
            <!--<a href=""><img src="images/logo_icon.png" alt=""></a>-->
        </div>
        <!--logo and iconic logo end-->

        <div class="left-side-inner">
            <!--sidebar nav start-->
            <ul class="nav nav-pills nav-stacked custom-nav">
                <li id="menu1" ><a href="index.html"><i class="fa fa-home"></i> <span>首页</span></a></li>

                <li id="menu2" class="menu-list"><a href=""><i class="fa fa-cogs"></i> <span>用户管理</span></a>
                    <ul class="sub-menu-list">
                        <li id="menu2-1"><a href="ds_user_list.html">用户管理</a></li>
                        <li id="menu2-2"><a href="ds_buyer_list.html">会员管理</a></li>
                    </ul>
                </li>

                <li id="menu3" class="menu-list active"><a href=""><i class="fa fa-desktop"></i> <span>电商管理</span></a>
                    <ul class="sub-menu-list">
                        <li id="menu3-1"><a href="ds_banner_list.html">轮播图管理</a></li>
                        <li id="menu3-2"  class="active"><a href="ds_category_list.html">分类管理</a></li>
                        <li id="menu3-3"><a href="ds_news_list.html">资讯设置</a></li>
                        <li id="menu3-4" ><a href="ds_goods_list.html">商品管理</a></li>
                        <li id="menu3-5" ><a href="ds_seller_list.html">商户管理</a></li>
                        <li id="menu3-6" ><a href="ds_order_list.html">订单管理</a></li>
                        <li id="menu3-7"><a href="ds_cash_list.html">提现管理</a></li>
                    </ul>
                </li>

            </ul>
            <!--sidebar nav end-->

        </div>
    </div>
    <!-- left side end-->
    
    <!-- main content start-->
    <div class="main-content" >

        <!-- header section start-->
        <div class="header-section">

        <!--toggle button start-->
        <a class="toggle-btn"><i class="fa fa-bars"></i></a>
        <!--toggle button end-->

        <!--search start-->
       <!-- <form class="searchform" action="index.html" method="post">
            <input type="text" class="form-control" name="keyword" placeholder="请输入您要搜索的内容..." />
        </form>-->
        <!--search end-->

            <!-- header section start-->
            <div class="header-section">

                <!--toggle button start-->
                <a class="toggle-btn"><i class="fa fa-bars"></i></a>
                <!--toggle button end-->

                <!--search start-->
                <!--search end-->
                <!--<form class="searchform" action="" method="post">
                    <input type="text" class="form-control" id="searchText" placeholder="请输入您要搜索的用户名..." />
                    <button>搜索</button>
                </form>-->

                <!--notification menu start -->
                <div class="menu-right">
                    <ul class="notification-menu">

                        <li>
                            <a href="#" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                <img src="images/photos/user-avatar.png" alt="" />
                                <span id="loginName"></span>
                                <span class="caret"></span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-usermenu pull-right">
                                <!--<li><a href="#"><i class="fa fa-user"></i>  个人信息</a></li>-->
                                <li><a href="#" id="changePwd"  data-toggle="modal" data-target="#changepwd-box"><i class="fa fa-cog"></i>修改密码</a></li>
                                <li><a href="#" id="logoutBtn"><i class="fa fa-sign-out"></i> 退出</a></li>
                            </ul>
                        </li>

                    </ul>
                </div>
                <!--notification menu end -->

            </div>

        </div>

        <!-- header section end-->
        <!-- page heading start-->
        <div class="page-heading">
            <ul class="breadcrumb">
                <li>
                    <a href="#">电商管理</a>
                </li>
                <li class="active">分类管理</li>
            </ul>

        </div>
        <!-- page heading start-->
        <!--<div class="page-heading">-->
            <!--页面标题-->
        <!--</div>-->
        <!-- page heading end-->

        <!--body wrapper start-->
        <div class="wrapper">

            <!--表格开始-->
            <div class="row">
                <div class="col-sm-12">
                    <section class="panel">
                        <header class="panel-heading">
                            分类管理

                            <span class="tools pull-right">
                            <button type="button" class="btn btn-info popovers"  data-toggle="modal" data-target="#deer-box">鹿身百宝</button>
                            <button type="button" class="btn btn-info popovers"  data-toggle="modal" data-target="#new-box">新建</button>
                            <!--<span class="tools pull-right">-->
                            <!--<a href="javascript:;" class="fa fa-chevron-down"></a>-->
                            <!--<a href="javascript:;" class="fa fa-times"></a>-->
                         </span>
                        </header>
                        <div class="panel-body">

                            <div class="adv-table">

                                <table  class="display table table-bordered table-striped" >
                                    <thead>
                                    <tr>
                                        <th>分类名称</th>
                                        <th>功效</th>
                                        <th>创建时间</th>
                                        <th>状态</th>
                                        <th>操作</th>
                                    </tr>
                                    </thead>
                                    <tbody id="contentTbody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
            <!--表格结束-->
        </div>
        <!--body wrapper end-->

        <!--footer section start-->
        <footer class="sticky-footer">
            2018 &copy; 版权所有
        </footer>
        <!--footer section end-->


    </div>
    <!-- main content end-->
</section>

<div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="delete-box" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">删除</h4>
            </div>
            <div class="modal-body">
                确定要删除记录吗？
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <button data-dismiss="modal" class="btn btn-default" type="button">取消</button>
                <button class="btn btn-info popovers" type="button" id="deleteBtn">确定</button>
            </div>
        </div>
    </div>
</div>

<!-- modal -->
<div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="new-box" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">新建分类</h4>
            </div>
            <div class="modal-body">

                <form role="form" id="addForm">
                    <div class="form-group">
                        <label>分类名称</label>
                        <input type="text" class="form-control" id="ctg_name" placeholder="请输入">
                    </div>
                    <div class="form-group">
                        <label>分类图片</label>
                        <input id="files" type="file" name="files" >
                    </div>
                    <div class="form-group">
                        <label>功效</label>
                        <textarea id="effect" rows="6" maxlength="50" onKeyDown='if (this.value.length>=50){if(event.keyCode != 8){event.returnValue=false;}}' class="form-control" placeholder="请输入功效,最多输入50个汉字···"></textarea>
                    </div>
                    <div class="form-group">
                        <label>上级分类</label>
                        <select class="form-control m-bot15"  id="pid">
                        </select>
                    </div>
                    <div class="form-group">
                        <label>状态</label>
                        <select class="form-control m-bot15"  id="status">
                            <option value="1">启用</option>
                            <option value="0">停用</option>
                        </select>
                    </div>

                </form>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <button class="btn btn-info popovers" type="button" id="addBtn">保存</button>
                <!--<button class="btn btn-info popovers" type="button" id="pzqd_addSaveBtn">保存并新增</button>-->
                <button data-dismiss="modal" class="btn btn-default" type="button">取消</button>
            </div>
        </div>
    </div>
</div>
<!-- modal -->
<div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="update-box" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">修改分类</h4>
            </div>
            <div class="modal-body">

                <form role="form" id="updateForm">
                    <div class="form-group">
                        <label>分类名称</label>
                        <input type="text" class="form-control" id="update_ctg_name" placeholder="请输入">
                    </div>
                    <div class="form-group">
                        <label>分类图片</label>
                        <input id="update_files" type="file" name="files" >
                    </div>
                    <div class="form-group">
                        <label>功效</label>
                        <textarea id="update_effect" rows="6" maxlength="50" onKeyDown='if (this.value.length>=50){if(event.keyCode != 8){event.returnValue=false;}}' class="form-control" placeholder="请输入功效,最多输入50个汉字···"></textarea>
                    </div>
                    <div class="form-group" id="pid_div">
                        <label>上级分类</label>
                        <select class="form-control m-bot15"  id="update_pid">
                        </select>
                    </div>
                    <div class="form-group" id="status_div">
                        <label>状态</label>
                        <select class="form-control m-bot15"  id="update_status">
                            <option value="1">启用</option>
                            <option value="0">停用</option>
                        </select>
                    </div>

                </form>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <button class="btn btn-info popovers" type="button" id="updateBtn">保存</button>
                <!--<button class="btn btn-info popovers" type="button" id="pzqd_addSaveBtn">保存并新增</button>-->
                <button data-dismiss="modal" class="btn btn-default" type="button">取消</button>
            </div>
        </div>
    </div>
</div>

<!-- modal -->
<div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="deer-box" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">鹿身百宝</h4>
            </div>
            <div class="modal-body">

                <form role="form" id="deerForm">
                    <select multiple="multiple" class="multi-select" id="deer_category"
                            name="my_multi_select2[]">
                    </select>
                </form>
            </div>
            <div class="clearfix"></div>
            <div class="modal-footer">
                <button class="btn btn-info popovers" type="button" id="deerBtn">保存</button>
                <!--<button class="btn btn-info popovers" type="button" id="pzqd_addSaveBtn">保存并新增</button>-->
                <button data-dismiss="modal" class="btn btn-default" type="button">取消</button>
            </div>
        </div>
    </div>
</div>
<!-- modal -->


<!-- Placed js at the end of the document so the pages load faster -->
<script src="js/jquery-1.10.2.min.js"></script>
<script src="js/jquery-ui-1.9.2.custom.min.js"></script>
<script src="js/jquery-migrate-1.2.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/modernizr.min.js"></script>
<script src="js/jquery.nicescroll.js"></script>
<!--multi-select-->
<script type="text/javascript" src="js/jquery-multi-select/js/jquery.multi-select.js"></script>
<script type="text/javascript" src="js/jquery-multi-select/js/jquery.quicksearch.js"></script>


<!--image upload-->
<script src="js/upload/plugins/sortable.js" type="text/javascript"></script>
<script src="js/upload/fileinput.js" type="text/javascript"></script>
<script src="js/upload/locales/zh.js" type="text/javascript"></script>
<script src="js/upload/themes/explorer-fa/theme.js" type="text/javascript"></script>
<script src="js/upload/themes/fa/theme.js" type="text/javascript"></script>


<!--common scripts for all pages-->
<script src="js/scripts.js"></script>

<script src="js/main/config.js"></script>
<script src="js/main/md5.js"></script>
<script src="js/main/ds_category.js"></script>

<script>
    var image= '';
    $(document).ready(function () {


        treeCategorys();

        /*$('#new-box').on('show.bs.modal', function () {
            selectGoods_category();
        });*/


        //toggle
        $('#contentTbody').on('click','.fa-plus-square',function(){
            $(this).parent().parent().next().removeClass('hide');
            $(this).removeClass('fa-plus-square').addClass('fa-minus-square');
        });
        $('#contentTbody').on('click','.fa-minus-square',function(){
            $(this).parent().parent().next().addClass('hide');
            $(this).removeClass('fa-minus-square').addClass('fa-plus-square');
        });

        // move
        $('#contentTbody').on('click','.upCategory',function(){
            var current = $(this).parent().parent();  //获取当前<tr>
            var currentSub = $(this).parent().parent().next();
            var prev = current.prev().prev();   //获取当前<tr>前两个元素
            var prevSub = current.prev();
            if (current.index() > 0) {
                current.insertBefore(prev);  //插入到当前<tr>前一个元素前
                currentSub.insertBefore(prev);  //插入到当前<tr>前一个元素前
            }
            var sort=new Array();
            $('#contentTbody .upCategory').each(function(){
                sort.push(categoryList[$(this).attr('index')].id)
            });
            updateCategoryOrder({'data':JSON.stringify(sort)});
        });
        $('#contentTbody').on('click','.downCategory',function(){
            var current = $(this).parent().parent();  //获取当前<tr>
            var currentSub = $(this).parent().parent().next();
            var next = currentSub.next();   //获取当前<tr>前两个元素
            var nextSub = currentSub.next().next();
            currentSub.insertAfter(nextSub);  //插入到当前<tr>前一个元素前
            current.insertAfter(nextSub);  //插入到当前<tr>前一个元素前
            var sort=new Array();
            $('#contentTbody .downCategory').each(function(){
                sort.push(categoryList[$(this).attr('index')].id)
            });
            updateCategoryOrder({'data':JSON.stringify(sort)});
        });
        $('.subContent').on('click','.upSubCategory',function(){
            var current = $(this).parent().parent();  //获取当前<tr>
            var prev = current.prev();
            if (current.index() > 0) {
                current.insertBefore(prev);  //插入到当前<tr>前一个元素前
            }
            var sort=new Array();
            $('#subContent'+categoryList[$(this).attr('index')].id+' .upSubCategory').each(function(){
                sort.push(categoryList[$(this).attr('index')].subcategory[$(this).attr('subindex')].id)
            });
            updateCategoryOrder({'data':JSON.stringify(sort)});
        });
        $('.subContent').on('click','.downSubCategory',function(){
            var current = $(this).parent().parent();  //获取当前<tr>
            var next = current.next();   //获取当前<tr>前两个元素
            current.insertAfter(next);  //插入到当前<tr>前一个元素前
            var sort=new Array();
            $('#subContent'+categoryList[$(this).attr('index')].id+' .upSubCategory').each(function(){
                sort.push(categoryList[$(this).attr('index')].subcategory[$(this).attr('subindex')].id)
            });
            updateCategoryOrder({'data':JSON.stringify(sort)});
        });


        //新建
        $('#addBtn').click(function () {
            if($('#ctg_name').val()==''){
                alert('分类名称不能为空！');
                return false;
            }
            if($('#effect').val()==''){
                alert('功效不能为空！');
                return false;
            }
            var params={};
            $('#addForm input').each(function () {
                if($(this).val()!='')
                    params[$(this).attr('id')]=$(this).val();
            });
            $('#addForm select').each(function () {
                if($(this).val()!='')
                    params[$(this).attr('id')]=$(this).val();
            });
            params['effect']=$('#effect').val();
            params["img"]=image;
            params["deer_flag"]='0';
            addCategory(params);
        });

        //修改
        $('#contentTbody').on('click','.updateCategory',function () {
            $('#status_div').removeClass("hide");
            categoryIndex=$(this).attr('index');
            currentCategory=categoryList[categoryIndex];
            for (var item in currentCategory) {
                $('#update_'+item).val(currentCategory[item]);
            }
            image=currentCategory['img'];
            $('#pid_div').addClass("hide");

        });


        $('.subContent').on('click','.updateSubCategory',function () {
            $('#status_div').addClass("hide");
            categoryIndex=$(this).attr('index');
            var subIndex=$(this).attr('subindex');
            var temp=categoryList[categoryIndex];
            currentCategory=temp['subcategory'][subIndex];
            for (var item in currentCategory) {
                $('#update_'+item).val(currentCategory[item]);
            }
            image=currentCategory['img'];
            $('#pid_div').removeClass("hide");

        });
        $('#updateBtn').click(function () {
            if($('#update_ctg_name').val()==''){
                alert('分类名称不能为空！');
                return false;
            }
            if($('#update_effect').val()==''){
                alert('功效不能为空！');
                return false;
            }
            var params={};
            $('#updateForm input').each(function () {
                if($(this).val()!='')
                    params[$(this).attr('id').replace('update_','')]=$(this).val();
            });
            $('#updateForm select').each(function () {
                if($(this).val()!='')
                    params[$(this).attr('id').replace('update_','')]=$(this).val();
            });
            params['effect']=$('#update_effect').val();
            params['id']=currentCategory.id;
            params["img"]=image;
            updateCategory(params);
        });



        //删除
        $('#contentTbody').on('click','.deleteCategory',function () {
            categoryIndex=$(this).attr('index');
            currentCategory=categoryList[categoryIndex];
        });
        $('#contentTbody').on('click','.deleteSubCategory',function () {
            categoryIndex=$(this).attr('index');
            var subIndex=$(this).attr('subindex');
            var temp=categoryList[categoryIndex];
            currentCategory=temp['subcategory'][subIndex];
        });
        $('#deleteBtn').click(function () {
            deleteCategory(currentCategory.id);
        });

        //鹿身百宝
        $('#deerBtn').click(function(){
            var params={'data':JSON.stringify($('#deer_category').val())};
            if($('#deer_category').val().length>12){
                alert("鹿身百宝最多可以设置12个！");
            }
            else{
                deerGoods_category(params);
            }

        });


        $('#update-box').on('show.bs.modal', function () {
            initFiles();
        });

        //图片上传
        $('#files').fileinput({
            theme: 'fa',
            language: 'zh',
            uploadAsync: true,//异步上传
            uploadUrl: uploadUrl+'filesUpload',
            allowedFileExtensions: ['jpg', 'png', 'gif','mp4'],
            showUpload: true,
            showCaption: false,
            showRemove : false, //显示移除按钮
            enctype: 'multipart/form-data',
            maxFileSize:0,
            maxFileCount:1,
            msgFilesTooMany: "选择上传的文件数量({n}) 超过允许的最大数值{m}！"
        }).on("filebatchselected", function(event, files) {
            //$(this).fileinput("upload");
        }).on("fileuploaded", function(event,data, previewId, index) { //异步上传成功结果处理
            if(data.response.data.length>0){
                image=data.response.data[0];
            }
        }).on('filesuccessremove', function (event, previewId,index) {
            image='';
        });


    });

    function initFiles() {
        $("#update_files").fileinput("destroy");
        $('#update_files').fileinput({
            theme: 'fa',
            language: 'zh',
            uploadAsync: true,//异步上传
            uploadUrl: uploadUrl+'filesUpload',
            allowedFileExtensions: ['jpg', 'png', 'gif','mp4'],
            showUpload: true,
            showCaption: false,
            showRemove : false, //显示移除按钮
            enctype: 'multipart/form-data',
            maxFileSize:0,
            maxFileCount:1,
            dropZoneTitle: '拖拽文件到这里 &hellip;',
            msgFilesTooMany: "选择上传的文件数量({n}) 超过允许的最大数值{m}！",

            //overwriteInitial: false, //不覆盖已存在的图片
            fileActionSettings:{showDrag:false},
            initialPreviewAsData: true,
            initialPreview: [
                image
            ],
            initialPreviewConfig: [
                {caption: "",  width: "120px", url: uploadUrl+"filesDelete", key: 1}
            ]

            /*initialPreviewAsData: true,
            initialPreview: [
                "http://lorempixel.com/1920/1080/transport/1",
                "http://lorempixel.com/1920/1080/transport/2",
                "http://lorempixel.com/1920/1080/transport/3"
            ],
            initialPreviewConfig: [
                {caption: "transport-1.jpg", size: 329892, width: "120px", url: "{$url}", key: 1},
                {caption: "transport-2.jpg", size: 872378, width: "120px", url: "{$url}", key: 2},
                {caption: "transport-3.jpg", size: 632762, width: "120px", url: "{$url}", key: 3}
            ]*/

        }).on("filebatchselected", function(event, files) {
            //$(this).fileinput("upload");
        }).on("fileuploaded", function(event,data, previewId, index) { //异步上传成功结果处理
            if(data.response.data.length>0){
                image=data.response.data[0];
            }
        }).on('filesuccessremove', function (event, previewId,index) {
            image='';
        }).on('filepredelete', function(event, key, jqXHR, data) {
            image='';
        }) ;

    }

</script>


</body>
</html>
